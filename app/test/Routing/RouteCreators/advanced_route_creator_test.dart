import 'dart:convert';

import 'package:app/Map/bus_route_geojson_loader.dart';
import 'package:app/MapData/bus_stop.dart';
import 'package:app/MapData/bus_time.dart';
import 'package:app/Routing/RouteCreators/advanced_route_creator.dart';
import 'package:app/Routing/Servers/routing_server.dart';
import 'package:app/Routing/geo_json_geometry.dart';
import 'package:app/Routing/location.dart';
import 'package:app/Routing/walking_route.dart';
import 'package:app/Wrapper/date_time_wrapper.dart';
import 'package:mockito/annotations.dart';
import 'package:mockito/mockito.dart';
import 'package:test/test.dart';

import 'advanced_route_creator_test.mocks.dart';

@GenerateMocks([RoutingServer])
@GenerateMocks([BusRouteGeoJsonLoader])
@GenerateMocks([DateTimeWrapper])
void main() {
  group('Advanced Route Creator Tests', () {

    test('.createRoute() route correctly created with no bus stops', () async {
      final server = MockRoutingServer();
      final geoJsonLoader = MockBusRouteGeoJsonLoader();
      final dateTimeWrapper = MockDateTimeWrapper();

      Set<BusStop> busStops = {};

      // Use Mockito to return a successful response when it calls the
      // routing server.
      Location location1 = Location(-1.0983533,50.798795);
      Location location2 = Location(-1.0980056609821778,50.797919492099254);
      when(server.getResponseBody(location1, location2)).thenAnswer((_) async =>
      '{"code":"Ok","routes":[{"geometry":{"coordinates":[[-1.098122,50.798742],[-1.098221,50.798569],[-1.098227,50.798557],[-1.098252,50.798471],[-1.098508,50.798057],[-1.098558,50.797978],[-1.098814,50.79759],[-1.098853,50.79753],[-1.098766,50.797509],[-1.098543,50.797487],[-1.098396,50.797472],[-1.098324,50.797469],[-1.098275,50.797067],[-1.098146,50.797102],[-1.098055,50.797128],[-1.097876,50.797359],[-1.097795,50.797519],[-1.097711,50.797502],[-1.097438,50.797936],[-1.097399,50.797943],[-1.097484,50.797997],[-1.097606,50.798028],[-1.097646,50.797951]],"type":"LineString"},"legs":[{"steps":[{"geometry":{"coordinates":[[-1.098122,50.798742],[-1.098221,50.798569],[-1.098227,50.798557],[-1.098252,50.798471],[-1.098508,50.798057],[-1.098558,50.797978],[-1.098814,50.79759],[-1.098853,50.79753]],"type":"LineString"},"maneuver":{"bearing_after":200,"bearing_before":0,"location":[-1.098122,50.798742],"modifier":"right","type":"depart"},"mode":"walking","driving_side":"right","name":"Lion Terrace","intersections":[{"out":0,"entry":[true],"bearings":[200],"location":[-1.098122,50.798742]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[15,30,195],"location":[-1.098252,50.798471]},{"out":1,"in":0,"entry":[false,true,true],"bearings":[15,195,285],"location":[-1.098508,50.798057]},{"out":1,"in":0,"entry":[false,true,true],"bearings":[15,210,285],"location":[-1.098558,50.797978]},{"out":1,"in":0,"entry":[false,true,true],"bearings":[30,195,285],"location":[-1.098814,50.79759]}],"weight":12.389999999,"duration":115.599999999,"distance":144.5},{"geometry":{"coordinates":[[-1.098853,50.79753],[-1.098766,50.797509],[-1.098543,50.797487],[-1.098396,50.797472],[-1.098324,50.797469]],"type":"LineString"},"maneuver":{"bearing_after":105,"bearing_before":201,"location":[-1.098853,50.79753],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":1,"in":0,"entry":[false,true,true,true],"bearings":[15,105,180,300],"location":[-1.098853,50.79753]}],"weight":3.81,"duration":30.5,"distance":38.1},{"geometry":{"coordinates":[[-1.098324,50.797469],[-1.098275,50.797067]],"type":"LineString"},"maneuver":{"bearing_after":174,"bearing_before":95,"location":[-1.098324,50.797469],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":1,"in":2,"entry":[true,true,false],"bearings":[90,180,270],"location":[-1.098324,50.797469]}],"weight":4.49,"duration":35.9,"distance":44.9},{"geometry":{"coordinates":[[-1.098275,50.797067],[-1.098146,50.797102],[-1.098055,50.797128],[-1.097876,50.797359],[-1.097795,50.797519],[-1.097711,50.797502]],"type":"LineString"},"maneuver":{"bearing_after":66,"bearing_before":174,"location":[-1.098275,50.797067],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":1,"in":0,"entry":[false,true,true],"bearings":[0,60,225],"location":[-1.098275,50.797067]},{"out":1,"in":2,"entry":[true,true,false],"bearings":[15,60,240],"location":[-1.098146,50.797102]},{"out":0,"in":2,"entry":[true,true,false],"bearings":[15,75,210],"location":[-1.097876,50.797359]}],"weight":7.04,"duration":56.4,"distance":70.5},{"geometry":{"coordinates":[[-1.097711,50.797502],[-1.097438,50.797936],[-1.097399,50.797943]],"type":"LineString"},"maneuver":{"bearing_after":21,"bearing_before":74,"location":[-1.097711,50.797502],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":2,"entry":[true,true,false],"bearings":[15,105,255],"location":[-1.097711,50.797502]}],"weight":5.49,"duration":43.9,"distance":54.8},{"geometry":{"coordinates":[[-1.097399,50.797943],[-1.097484,50.797997],[-1.097606,50.798028]],"type":"LineString"},"maneuver":{"bearing_after":310,"bearing_before":35,"location":[-1.097399,50.797943],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[90,210,315],"location":[-1.097399,50.797943]}],"weight":1.78,"duration":14.2,"distance":17.8},{"geometry":{"coordinates":[[-1.097606,50.798028],[-1.097646,50.797951]],"type":"LineString"},"maneuver":{"bearing_after":196,"bearing_before":292,"location":[-1.097606,50.798028],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[15,120,195],"location":[-1.097606,50.798028]}],"weight":0.9,"duration":7.2,"distance":9},{"geometry":{"coordinates":[[-1.097646,50.797951],[-1.097646,50.797951]],"type":"LineString"},"maneuver":{"bearing_after":0,"bearing_before":198,"location":[-1.097646,50.797951],"modifier":"right","type":"arrive"},"mode":"walking","driving_side":"right","name":"","intersections":[{"in":0,"entry":[true],"bearings":[18],"location":[-1.097646,50.797951]}],"weight":0,"duration":0,"distance":0}],"summary":"Lion Terrace","weight":35.9,"duration":303.7,"distance":379.6}],"weight_name":"routability","weight":35.9,"duration":303.7,"distance":379.6}],"waypoints":[{"hint":"YFdigIlGlZbNAAAATAAAAAAAAAAfAgAAnsijQQ2n8kAAAAAAwwNZQqMAAAA9AAAAAAAAALIBAABIAAAAdj7v_5YgBwOPPe__yyAHAwAAPwEKQCFz","distance":17.327875572,"name":"Lion Terrace","location":[-1.098122,50.798742]},{"hint":"XAb8l14G_JcAAAAAWgAAAAAAAAAAAAAAAAAAAMdLEEEAAAAAAAAAAAAAAABIAAAAAAAAAAAAAABIAAAAUkDv_38dBwPqPu__Xx0HAwAALwEKQCFz","distance":25.641497556,"name":"","location":[-1.097646,50.797951]}]}');

      WalkingRoute testRoute = WalkingRoute({GeoJsonGeometry('{"coordinates":[[-1.098122,50.798742],[-1.098221,50.798569],[-1.098227,50.798557],[-1.098252,50.798471],[-1.098508,50.798057],[-1.098558,50.797978],[-1.098814,50.79759],[-1.098853,50.79753],[-1.098766,50.797509],[-1.098543,50.797487],[-1.098396,50.797472],[-1.098324,50.797469],[-1.098275,50.797067],[-1.098146,50.797102],[-1.098055,50.797128],[-1.097876,50.797359],[-1.097795,50.797519],[-1.097711,50.797502],[-1.097438,50.797936],[-1.097399,50.797943],[-1.097484,50.797997],[-1.097606,50.798028],[-1.097646,50.797951]],"type":"LineString"}')},
          303.7, 379.6, 144.5, '"right"');

      AdvancedRouteCreator routeCreator = AdvancedRouteCreator.setServer(busStops, server, geoJsonLoader, dateTimeWrapper);
      WalkingRoute route = await routeCreator.createRoute(location1, location2);

      expect(route.getGeometries(), testRoute.getGeometries());
      expect(route.getDistanceTillNextTurn(), testRoute.getDistanceTillNextTurn());
      expect(route.getNextTurn(), testRoute.getNextTurn());
      expect(route.getTotalDistance(), testRoute.getTotalDistance());
      expect(route.getTotalSeconds(), testRoute.getTotalSeconds());
    });

    test('.createRoute() route correctly created along bus route', () async {
      final server = MockRoutingServer();
      final geoJsonLoader = MockBusRouteGeoJsonLoader();
      final dateTimeWrapper = MockDateTimeWrapper();

      BusStop busStop1 = BusStop("U1-1", "Prince", -1.05857233024616, 50.7925695232834,
          {}, {BusTime("13:22", 1)}, true, 0);
      BusStop busStop2 = BusStop("U1-2", "GetOff", -1.09238477219601, 50.7953755013164,
          {BusTime("13:32", 1)}, {}, true, 0);
      busStop1.setNextBusStop(busStop2);
      busStop1.setPrevBusStop(busStop2);
      busStop2.setNextBusStop(busStop1);
      busStop2.setPrevBusStop(busStop1);
      Set<BusStop> busStops = {busStop1,busStop2};

      // Use Mockito to return a successful response when it calls the routing server.
      Location startLocation = Location(-1.0572793226769477, 50.79220425608969);
      Location endLocation = Location(-1.099776858978281, 50.797431554668776);
      when(server.getResponseBody(startLocation, endLocation)).thenAnswer((_) async =>
      '{"code":"Ok","routes":[{"geometry":{"coordinates":[[-1.057275,50.792214],[-1.057246,50.792209],[-1.057252,50.792282],[-1.057355,50.792363],[-1.057475,50.792403],[-1.057563,50.792431],[-1.057659,50.792463],[-1.057834,50.792513],[-1.058099,50.792611],[-1.058362,50.792733],[-1.058585,50.79278],[-1.058748,50.792804],[-1.058947,50.792891],[-1.0591,50.792996],[-1.059244,50.793033],[-1.059403,50.793062],[-1.059647,50.793099],[-1.059681,50.793028],[-1.059686,50.793017],[-1.059718,50.792964],[-1.060055,50.79308],[-1.060321,50.792738],[-1.060532,50.792475],[-1.060758,50.792204],[-1.060952,50.791949],[-1.061384,50.791408],[-1.063308,50.791775],[-1.063355,50.791482],[-1.0658,50.791795],[-1.068049,50.792144],[-1.068062,50.791821],[-1.06813,50.791709],[-1.068604,50.791798],[-1.068719,50.791819],[-1.068927,50.791858],[-1.069031,50.791878],[-1.069149,50.79194],[-1.069185,50.792031],[-1.069173,50.792089],[-1.06954,50.792117],[-1.070507,50.792189],[-1.070733,50.792229],[-1.071239,50.792385],[-1.071559,50.792454],[-1.071995,50.792516],[-1.072695,50.792618],[-1.073375,50.792721],[-1.073943,50.792783],[-1.076319,50.792858],[-1.076383,50.793224],[-1.077223,50.793209],[-1.078053,50.793192],[-1.078473,50.793178],[-1.078612,50.793168],[-1.078827,50.793152],[-1.079143,50.793173],[-1.079201,50.793177],[-1.079252,50.793125],[-1.079874,50.793141],[-1.080212,50.793151],[-1.080254,50.793158],[-1.080289,50.79317],[-1.080251,50.793209],[-1.080277,50.793219],[-1.08034,50.793239],[-1.081208,50.79348],[-1.082178,50.793751],[-1.08375,50.794406],[-1.083888,50.794322],[-1.084311,50.79405],[-1.085788,50.794753],[-1.085898,50.794756],[-1.085925,50.794785],[-1.086403,50.7948],[-1.086718,50.794623],[-1.087315,50.794952],[-1.087672,50.794975],[-1.087845,50.795039],[-1.088182,50.795095],[-1.088216,50.795101],[-1.088269,50.795119],[-1.088329,50.795139],[-1.088524,50.795188],[-1.08872,50.795159],[-1.088813,50.795171],[-1.088852,50.795175],[-1.089072,50.795219],[-1.089335,50.795171],[-1.089717,50.795191],[-1.090322,50.795256],[-1.091183,50.795338],[-1.091393,50.795356],[-1.091666,50.795375],[-1.092066,50.795398],[-1.093141,50.795458],[-1.093618,50.795492],[-1.0939,50.795503],[-1.09392,50.795559],[-1.093933,50.795597],[-1.093948,50.795641],[-1.094025,50.795729],[-1.093985,50.795769],[-1.093916,50.79583],[-1.094006,50.795878],[-1.094408,50.796028],[-1.094875,50.796171],[-1.094596,50.796532],[-1.094755,50.796535],[-1.094917,50.79653],[-1.094918,50.796567],[-1.094901,50.797116],[-1.095065,50.797036],[-1.095561,50.797016],[-1.095566,50.797052],[-1.09563,50.797045],[-1.09568,50.797042],[-1.095691,50.797121],[-1.095773,50.797108],[-1.095877,50.797092],[-1.095941,50.797165],[-1.095965,50.79723],[-1.098634,50.796654],[-1.098766,50.796553],[-1.098777,50.796663],[-1.098802,50.796927],[-1.099919,50.797197]],"type":"LineString"},"legs":[{"steps":[{"geometry":{"coordinates":[[-1.057275,50.792214],[-1.057246,50.792209]],"type":"LineString"},"maneuver":{"bearing_after":105,"bearing_before":0,"location":[-1.057275,50.792214],"type":"depart"},"mode":"walking","ref":"A2030","driving_side":"right","name":"Goldsmith Avenue","intersections":[{"out":0,"entry":[true],"bearings":[105],"location":[-1.057275,50.792214]}],"weight":0.31,"duration":1.7,"distance":2.1},{"geometry":{"coordinates":[[-1.057246,50.792209],[-1.057252,50.792282]],"type":"LineString"},"maneuver":{"bearing_after":355,"bearing_before":102,"location":[-1.057246,50.792209],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":2,"entry":[true,true,false],"bearings":[0,105,285],"location":[-1.057246,50.792209]}],"weight":0.68,"duration":6.5,"distance":8.1},{"geometry":{"coordinates":[[-1.057252,50.792282],[-1.057355,50.792363],[-1.057475,50.792403],[-1.057563,50.792431],[-1.057659,50.792463],[-1.057834,50.792513],[-1.058099,50.792611],[-1.058362,50.792733],[-1.058585,50.79278],[-1.058748,50.792804],[-1.058947,50.792891],[-1.0591,50.792996],[-1.059244,50.793033],[-1.059403,50.793062],[-1.059647,50.793099]],"type":"LineString"},"maneuver":{"bearing_after":320,"bearing_before":355,"location":[-1.057252,50.792282],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":4,"in":2,"entry":[true,true,false,true,true],"bearings":[30,90,180,270,315],"location":[-1.057252,50.792282]},{"out":4,"in":2,"entry":[true,true,false,true,true],"bearings":[15,75,135,240,300],"location":[-1.057355,50.792363]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[15,120,240,300],"location":[-1.057475,50.792403]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[45,120,300],"location":[-1.057659,50.792463]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,120,180,300],"location":[-1.058099,50.792611]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[75,105,285],"location":[-1.059244,50.793033]}],"weight":16.290000000,"duration":156.5,"distance":195.6},{"geometry":{"coordinates":[[-1.059647,50.793099],[-1.059681,50.793028],[-1.059686,50.793017],[-1.059718,50.792964]],"type":"LineString"},"maneuver":{"bearing_after":195,"bearing_before":282,"location":[-1.059647,50.793099],"modifier":"left","type":"end of road"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[15,105,195],"location":[-1.059647,50.793099]},{"out":2,"in":0,"entry":[false,true,true,true],"bearings":[15,120,195,300],"location":[-1.059686,50.793017]}],"weight":1.33,"duration":12.7,"distance":15.8},{"geometry":{"coordinates":[[-1.059718,50.792964],[-1.060055,50.79308]],"type":"LineString"},"maneuver":{"bearing_after":298,"bearing_before":199,"location":[-1.059718,50.792964],"modifier":"right","type":"end of road"},"mode":"walking","ref":"A2030","driving_side":"right","name":"Goldsmith Avenue","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[15,120,300],"location":[-1.059718,50.792964]}],"weight":3.86,"duration":21.6,"distance":27},{"geometry":{"coordinates":[[-1.060055,50.79308],[-1.060321,50.792738],[-1.060532,50.792475],[-1.060758,50.792204],[-1.060952,50.791949],[-1.061384,50.791408]],"type":"LineString"},"maneuver":{"bearing_after":205,"bearing_before":298,"location":[-1.060055,50.79308],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"Clovelly Road","intersections":[{"out":1,"in":0,"entry":[false,true,true],"bearings":[120,210,300],"location":[-1.060055,50.79308]},{"out":2,"in":0,"entry":[false,true,true,true],"bearings":[30,120,210,300],"location":[-1.060532,50.792475]},{"out":2,"in":0,"entry":[false,true,true,true],"bearings":[30,120,210,300],"location":[-1.060952,50.791949]}],"weight":20.83,"duration":166.7,"distance":208.3},{"geometry":{"coordinates":[[-1.061384,50.791408],[-1.063308,50.791775]],"type":"LineString"},"maneuver":{"bearing_after":285,"bearing_before":206,"location":[-1.061384,50.791408],"modifier":"right","type":"end of road"},"mode":"walking","driving_side":"right","name":"Evans Road","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[30,105,285],"location":[-1.061384,50.791408]}],"weight":14.17,"duration":113.4,"distance":141.7},{"geometry":{"coordinates":[[-1.063308,50.791775],[-1.063355,50.791482]],"type":"LineString"},"maneuver":{"bearing_after":185,"bearing_before":285,"location":[-1.063308,50.791775],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"Winter Road","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,105,180],"location":[-1.063308,50.791775]}],"weight":3.28,"duration":26.2,"distance":32.8},{"geometry":{"coordinates":[[-1.063355,50.791482],[-1.0658,50.791795],[-1.068049,50.792144]],"type":"LineString"},"maneuver":{"bearing_after":281,"bearing_before":185,"location":[-1.063355,50.791482],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"Heyshott Road","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[0,180,285],"location":[-1.063355,50.791482]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[15,105,195,285],"location":[-1.0658,50.791795]}],"weight":33.92,"duration":271.5,"distance":339.3},{"geometry":{"coordinates":[[-1.068049,50.792144],[-1.068062,50.791821],[-1.06813,50.791709]],"type":"LineString"},"maneuver":{"bearing_after":181,"bearing_before":282,"location":[-1.068049,50.792144],"modifier":"left","type":"end of road"},"mode":"walking","driving_side":"right","name":"Frensham Road","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,105,180],"location":[-1.068049,50.792144]}],"weight":4.93,"duration":39.5,"distance":49.3},{"geometry":{"coordinates":[[-1.06813,50.791709],[-1.068604,50.791798],[-1.068719,50.791819],[-1.068927,50.791858],[-1.069031,50.791878]],"type":"LineString"},"maneuver":{"bearing_after":285,"bearing_before":201,"location":[-1.06813,50.791709],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"Devonshire Avenue","intersections":[{"out":4,"in":0,"entry":[false,true,true,true,true],"bearings":[15,105,120,195,285],"location":[-1.06813,50.791709]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[15,105,285],"location":[-1.068719,50.791819]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[105,195,285],"location":[-1.068927,50.791858]}],"weight":6.630000000,"duration":53.000000000,"distance":66.3},{"geometry":{"coordinates":[[-1.069031,50.791878],[-1.069149,50.79194],[-1.069185,50.792031]],"type":"LineString"},"maneuver":{"bearing_after":310,"bearing_before":285,"location":[-1.069031,50.791878],"modifier":"slight right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true,true],"bearings":[105,255,315,345],"location":[-1.069031,50.791878]}],"weight":2.12,"duration":16.9,"distance":21.2},{"geometry":{"coordinates":[[-1.069185,50.792031],[-1.069173,50.792089]],"type":"LineString"},"maneuver":{"bearing_after":7,"bearing_before":344,"location":[-1.069185,50.792031],"modifier":"slight right","type":"turn"},"mode":"walking","driving_side":"right","name":"Devonshire Square","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[0,165,195],"location":[-1.069185,50.792031]}],"weight":0.65,"duration":5.2,"distance":6.5},{"geometry":{"coordinates":[[-1.069173,50.792089],[-1.06954,50.792117],[-1.070507,50.792189]],"type":"LineString"},"maneuver":{"bearing_after":275,"bearing_before":7,"location":[-1.069173,50.792089],"modifier":"left","type":"continue"},"mode":"walking","driving_side":"right","name":"Devonshire Square","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,270],"location":[-1.069173,50.792089]}],"weight":9.48,"duration":75.8,"distance":94.8},{"geometry":{"coordinates":[[-1.070507,50.792189],[-1.070733,50.792229],[-1.071239,50.792385],[-1.071559,50.792454],[-1.071995,50.792516],[-1.072695,50.792618],[-1.073375,50.792721],[-1.073943,50.792783],[-1.076319,50.792858]],"type":"LineString"},"maneuver":{"bearing_after":285,"bearing_before":275,"location":[-1.070507,50.792189],"modifier":"straight","type":"new name"},"mode":"walking","driving_side":"right","name":"Jessie Road","intersections":[{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[15,90,195,285],"location":[-1.070507,50.792189]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[120,195,285],"location":[-1.071239,50.792385]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[105,195,285],"location":[-1.071995,50.792516]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[105,195,285],"location":[-1.072695,50.792618]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[15,105,195,285],"location":[-1.073375,50.792721]}],"weight":42.010000000,"duration":335.9,"distance":420},{"geometry":{"coordinates":[[-1.076319,50.792858],[-1.076383,50.793224]],"type":"LineString"},"maneuver":{"bearing_after":352,"bearing_before":272,"location":[-1.076319,50.792858],"modifier":"right","type":"end of road"},"mode":"walking","driving_side":"right","name":"Fawcett Road","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[0,90,165],"location":[-1.076319,50.792858]}],"weight":4.1,"duration":32.8,"distance":41},{"geometry":{"coordinates":[[-1.076383,50.793224],[-1.077223,50.793209],[-1.078053,50.793192],[-1.078473,50.793178],[-1.078612,50.793168]],"type":"LineString"},"maneuver":{"bearing_after":267,"bearing_before":352,"location":[-1.076383,50.793224],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"Cleveland Road","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,270],"location":[-1.076383,50.793224]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,90,270],"location":[-1.077223,50.793209]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,90,270],"location":[-1.078053,50.793192]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,180,270],"location":[-1.078473,50.793178]}],"weight":15.75,"duration":125.9,"distance":157.4},{"geometry":{"coordinates":[[-1.078612,50.793168],[-1.078827,50.793152],[-1.079143,50.793173],[-1.079201,50.793177],[-1.079252,50.793125],[-1.079874,50.793141],[-1.080212,50.793151],[-1.080254,50.793158],[-1.080289,50.79317]],"type":"LineString"},"maneuver":{"bearing_after":261,"bearing_before":262,"location":[-1.078612,50.793168],"modifier":"straight","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,90,270],"location":[-1.078612,50.793168]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[15,90,225],"location":[-1.079201,50.793177]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,180,270],"location":[-1.079874,50.793141]}],"weight":11.530000000,"duration":97.699999999,"distance":122.3},{"geometry":{"coordinates":[[-1.080289,50.79317],[-1.080251,50.793209]],"type":"LineString"},"maneuver":{"bearing_after":30,"bearing_before":275,"location":[-1.080289,50.79317],"modifier":"right","type":"end of road"},"mode":"walking","ref":"B2151","driving_side":"right","name":"Victoria Road North","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[30,90,210],"location":[-1.080289,50.79317]}],"weight":0.64,"duration":4.1,"distance":5.1},{"geometry":{"coordinates":[[-1.080251,50.793209],[-1.080277,50.793219],[-1.08034,50.793239],[-1.081208,50.79348],[-1.082178,50.793751],[-1.08375,50.794406]],"type":"LineString"},"maneuver":{"bearing_after":293,"bearing_before":30,"location":[-1.080251,50.793209],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"Bailey\'s Road","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[30,210,300],"location":[-1.080251,50.793209]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[120,210,300],"location":[-1.081208,50.79348]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[30,120,210,300],"location":[-1.082178,50.793751]}],"weight":28.14,"duration":225.1,"distance":281.4},{"geometry":{"coordinates":[[-1.08375,50.794406],[-1.083888,50.794322],[-1.084311,50.79405]],"type":"LineString"},"maneuver":{"bearing_after":225,"bearing_before":302,"location":[-1.08375,50.794406],"modifier":"left","type":"end of road"},"mode":"walking","driving_side":"right","name":"Somers Road","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[45,120,225],"location":[-1.08375,50.794406]},{"out":1,"in":0,"entry":[false,true,true],"bearings":[45,225,300],"location":[-1.083888,50.794322]}],"weight":5.6,"duration":44.8,"distance":56},{"geometry":{"coordinates":[[-1.084311,50.79405],[-1.085788,50.794753],[-1.085898,50.794756]],"type":"LineString"},"maneuver":{"bearing_after":306,"bearing_before":223,"location":[-1.084311,50.79405],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"River\'s Street","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[45,225,300],"location":[-1.084311,50.79405]}],"weight":13.81,"duration":110.4,"distance":138},{"geometry":{"coordinates":[[-1.085898,50.794756],[-1.085925,50.794785],[-1.086403,50.7948],[-1.086718,50.794623],[-1.087315,50.794952],[-1.087672,50.794975],[-1.087845,50.795039],[-1.088182,50.795095],[-1.088216,50.795101],[-1.088269,50.795119],[-1.088329,50.795139],[-1.088524,50.795188]],"type":"LineString"},"maneuver":{"bearing_after":292,"bearing_before":271,"location":[-1.085898,50.794756],"modifier":"slight right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,210,300],"location":[-1.085898,50.794756]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,135,300],"location":[-1.087672,50.794975]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[15,105,300],"location":[-1.088182,50.795095]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[120,195,300],"location":[-1.088269,50.795119]}],"weight":21.330000000,"duration":170.6,"distance":213.3},{"geometry":{"coordinates":[[-1.088524,50.795188],[-1.08872,50.795159],[-1.088813,50.795171],[-1.088852,50.795175],[-1.089072,50.795219],[-1.089335,50.795171]],"type":"LineString"},"maneuver":{"bearing_after":255,"bearing_before":291,"location":[-1.088524,50.795188],"modifier":"slight left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":1,"in":0,"entry":[false,true,true],"bearings":[105,255,300],"location":[-1.088524,50.795188]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,165,285],"location":[-1.088813,50.795171]}],"weight":5.93,"duration":47.400000000,"distance":59.3},{"geometry":{"coordinates":[[-1.089335,50.795171],[-1.089717,50.795191],[-1.090322,50.795256],[-1.091183,50.795338],[-1.091393,50.795356],[-1.091666,50.795375],[-1.092066,50.795398],[-1.093141,50.795458],[-1.093618,50.795492],[-1.0939,50.795503]],"type":"LineString"},"maneuver":{"bearing_after":274,"bearing_before":254,"location":[-1.089335,50.795171],"modifier":"slight right","type":"fork"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[75,240,270],"location":[-1.089335,50.795171]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,105,180,285],"location":[-1.090322,50.795256]},{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,105,285],"location":[-1.091183,50.795338]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[60,105,225,270],"location":[-1.091393,50.795356]},{"out":2,"in":0,"entry":[false,true,true,true],"bearings":[90,150,270,315],"location":[-1.091666,50.795375]},{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,180,270],"location":[-1.092066,50.795398]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,90,195,270],"location":[-1.093141,50.795458]}],"weight":32.42,"duration":259.4,"distance":324.3},{"geometry":{"coordinates":[[-1.0939,50.795503],[-1.09392,50.795559],[-1.093933,50.795597],[-1.093948,50.795641],[-1.094025,50.795729],[-1.093985,50.795769],[-1.093916,50.79583]],"type":"LineString"},"maneuver":{"bearing_after":345,"bearing_before":272,"location":[-1.0939,50.795503],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,255,345],"location":[-1.0939,50.795503]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[90,165,255,345],"location":[-1.09392,50.795559]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[75,165,270,330],"location":[-1.093948,50.795641]},{"out":0,"in":3,"entry":[true,true,true,false,true],"bearings":[30,105,120,180,300],"location":[-1.093985,50.795769]}],"weight":3.640000000,"duration":32.5,"distance":40.5},{"geometry":{"coordinates":[[-1.093916,50.79583],[-1.094006,50.795878],[-1.094408,50.796028],[-1.094875,50.796171]],"type":"LineString"},"maneuver":{"bearing_after":307,"bearing_before":35,"location":[-1.093916,50.79583],"modifier":"left","type":"end of road"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[90,210,315],"location":[-1.093916,50.79583]}],"weight":6.48,"duration":62.2,"distance":77.8},{"geometry":{"coordinates":[[-1.094875,50.796171],[-1.094596,50.796532]],"type":"LineString"},"maneuver":{"bearing_after":25,"bearing_before":295,"location":[-1.094875,50.796171],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[30,120,285],"location":[-1.094875,50.796171]}],"weight":3.73,"duration":35.8,"distance":44.7},{"geometry":{"coordinates":[[-1.094596,50.796532],[-1.094755,50.796535],[-1.094917,50.79653]],"type":"LineString"},"maneuver":{"bearing_after":270,"bearing_before":25,"location":[-1.094596,50.796532],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true,true],"bearings":[120,210,270,345],"location":[-1.094596,50.796532]}],"weight":1.89,"duration":18.2,"distance":22.7},{"geometry":{"coordinates":[[-1.094917,50.79653],[-1.094918,50.796567],[-1.094901,50.797116]],"type":"LineString"},"maneuver":{"bearing_after":358,"bearing_before":267,"location":[-1.094917,50.79653],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[0,90,270],"location":[-1.094917,50.79653]},{"out":0,"in":2,"entry":[true,true,false,true],"bearings":[0,90,180,270],"location":[-1.094918,50.796567]}],"weight":5.43,"duration":52.199999999,"distance":65.2},{"geometry":{"coordinates":[[-1.094901,50.797116],[-1.095065,50.797036],[-1.095561,50.797016]],"type":"LineString"},"maneuver":{"bearing_after":232,"bearing_before":0,"location":[-1.094901,50.797116],"modifier":"sharp left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,225],"location":[-1.094901,50.797116]}],"weight":4.14,"duration":39.7,"distance":49.7},{"geometry":{"coordinates":[[-1.095561,50.797016],[-1.095566,50.797052]],"type":"LineString"},"maneuver":{"bearing_after":354,"bearing_before":265,"location":[-1.095561,50.797016],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[0,90,180],"location":[-1.095561,50.797016]}],"weight":0.4,"duration":3.2,"distance":4},{"geometry":{"coordinates":[[-1.095566,50.797052],[-1.09563,50.797045]],"type":"LineString"},"maneuver":{"bearing_after":260,"bearing_before":354,"location":[-1.095566,50.797052],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,255],"location":[-1.095566,50.797052]}],"weight":0.46,"duration":3.7,"distance":4.6},{"geometry":{"coordinates":[[-1.09563,50.797045],[-1.09568,50.797042],[-1.095691,50.797121],[-1.095773,50.797108],[-1.095877,50.797092]],"type":"LineString"},"maneuver":{"bearing_after":324,"bearing_before":260,"location":[-1.09563,50.797045],"modifier":"slight right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,75,180,330],"location":[-1.09563,50.797045]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,120,180,255],"location":[-1.095773,50.797108]}],"weight":2.58,"duration":20.7,"distance":25.9},{"geometry":{"coordinates":[[-1.095877,50.797092],[-1.095941,50.797165],[-1.095965,50.79723]],"type":"LineString"},"maneuver":{"bearing_after":330,"bearing_before":255,"location":[-1.095877,50.797092],"modifier":"right","type":"end of road"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[75,165,330],"location":[-1.095877,50.797092]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[60,150,255,345],"location":[-1.095941,50.797165]}],"weight":1.67,"duration":13.3,"distance":16.7},{"geometry":{"coordinates":[[-1.095965,50.79723],[-1.098634,50.796654],[-1.098766,50.796553]],"type":"LineString"},"maneuver":{"bearing_after":250,"bearing_before":345,"location":[-1.095965,50.79723],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[30,165,255],"location":[-1.095965,50.79723]}],"weight":17.79,"duration":172.8,"distance":213.5},{"geometry":{"coordinates":[[-1.098766,50.796553],[-1.098777,50.796663],[-1.098802,50.796927]],"type":"LineString"},"maneuver":{"bearing_after":355,"bearing_before":219,"location":[-1.098766,50.796553],"modifier":"sharp right","type":"turn"},"mode":"walking","driving_side":"right","name":"Burnaby Road","intersections":[{"out":0,"in":1,"entry":[true,false,true,true,true,true],"bearings":[0,45,75,180,225,255],"location":[-1.098766,50.796553]}],"weight":4.17,"duration":33.3,"distance":41.7},{"geometry":{"coordinates":[[-1.098802,50.796927],[-1.099919,50.797197]],"type":"LineString"},"maneuver":{"bearing_after":289,"bearing_before":355,"location":[-1.098802,50.796927],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,285],"location":[-1.098802,50.796927]}],"weight":8.44,"duration":67.5,"distance":84.3},{"geometry":{"coordinates":[[-1.099919,50.797197],[-1.099919,50.797197]],"type":"LineString"},"maneuver":{"bearing_after":0,"bearing_before":291,"location":[-1.099919,50.797197],"modifier":"right","type":"arrive"},"mode":"walking","driving_side":"right","name":"","intersections":[{"in":0,"entry":[true],"bearings":[111],"location":[-1.099919,50.797197]}],"weight":0,"duration":0,"distance":0}],"summary":"Heyshott Road, Jessie Road","weight":360.56,"duration":2976.4,"distance":3718}],"weight_name":"routability","weight":360.56,"duration":2976.4,"distance":3718}],"waypoints":[{"hint":"w8hAhX4DrpXfAAAAHwAAAEUCAAAAAAAAKRR6QWerB0A9qSJCAAAAAH0AAAARAAAARQEAAAAAAABIAAAABd7v_xYHBwMB3u__DAcHAwIAjwYKQCFz","distance":1.147662261,"name":"Goldsmith Avenue","location":[-1.057275,50.792214]},{"hint":"WKShilmkoYrbAQAATAMAAAAAAAAAAAAAJVg-QgqkqEIAAAAAAAAAAHwBAACjAgAAAAAAAAAAAABIAAAAcTfv_40aBwP_N-__eBsHAwAA7wYKQCFz","distance":27.995461063,"name":"","location":[-1.099919,50.797197]}]}');

      Location firstBusStop = Location(-1.05857233024616, 50.7925695232834);
      when(server.getResponseBody(startLocation, firstBusStop)).thenAnswer((_) async =>
      '{"code":"Ok","routes":[{"geometry":{"coordinates":[[-1.057275,50.792214],[-1.057246,50.792209],[-1.057252,50.792282],[-1.057355,50.792363],[-1.057475,50.792403],[-1.057586,50.792364],[-1.057751,50.792382],[-1.058033,50.792459],[-1.058116,50.792485],[-1.058153,50.792434],[-1.058568,50.792574]],"type":"LineString"},"legs":[{"steps":[{"geometry":{"coordinates":[[-1.057275,50.792214],[-1.057246,50.792209]],"type":"LineString"},"maneuver":{"bearing_after":105,"bearing_before":0,"location":[-1.057275,50.792214],"type":"depart"},"mode":"walking","ref":"A2030","driving_side":"right","name":"Goldsmith Avenue","intersections":[{"out":0,"entry":[true],"bearings":[105],"location":[-1.057275,50.792214]}],"weight":0.31,"duration":1.7,"distance":2.1},{"geometry":{"coordinates":[[-1.057246,50.792209],[-1.057252,50.792282]],"type":"LineString"},"maneuver":{"bearing_after":355,"bearing_before":102,"location":[-1.057246,50.792209],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":2,"entry":[true,true,false],"bearings":[0,105,285],"location":[-1.057246,50.792209]}],"weight":0.68,"duration":6.5,"distance":8.1},{"geometry":{"coordinates":[[-1.057252,50.792282],[-1.057355,50.792363],[-1.057475,50.792403]],"type":"LineString"},"maneuver":{"bearing_after":320,"bearing_before":355,"location":[-1.057252,50.792282],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":4,"in":2,"entry":[true,true,false,true,true],"bearings":[30,90,180,270,315],"location":[-1.057252,50.792282]},{"out":4,"in":2,"entry":[true,true,false,true,true],"bearings":[15,75,135,240,300],"location":[-1.057355,50.792363]}],"weight":1.76,"duration":17,"distance":21.1},{"geometry":{"coordinates":[[-1.057475,50.792403],[-1.057586,50.792364],[-1.057751,50.792382],[-1.058033,50.792459],[-1.058116,50.792485]],"type":"LineString"},"maneuver":{"bearing_after":243,"bearing_before":296,"location":[-1.057475,50.792403],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true,true],"bearings":[15,120,240,300],"location":[-1.057475,50.792403]}],"weight":4.9,"duration":39.1,"distance":48.9},{"geometry":{"coordinates":[[-1.058116,50.792485],[-1.058153,50.792434]],"type":"LineString"},"maneuver":{"bearing_after":203,"bearing_before":295,"location":[-1.058116,50.792485],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true,true],"bearings":[0,120,210,300],"location":[-1.058116,50.792485]}],"weight":0.52,"duration":5,"distance":6.2},{"geometry":{"coordinates":[[-1.058153,50.792434],[-1.058568,50.792574]],"type":"LineString"},"maneuver":{"bearing_after":296,"bearing_before":203,"location":[-1.058153,50.792434],"modifier":"right","type":"turn"},"mode":"walking","ref":"A2030","driving_side":"right","name":"Goldsmith Avenue","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[30,120,300],"location":[-1.058153,50.792434]}],"weight":4.75,"duration":26.6,"distance":33.2},{"geometry":{"coordinates":[[-1.058568,50.792574],[-1.058568,50.792574]],"type":"LineString"},"maneuver":{"bearing_after":0,"bearing_before":298,"location":[-1.058568,50.792574],"type":"arrive"},"mode":"walking","ref":"A2030","driving_side":"right","name":"Goldsmith Avenue","intersections":[{"in":0,"entry":[true],"bearings":[118],"location":[-1.058568,50.792574]}],"weight":0,"duration":0,"distance":0}],"summary":"Goldsmith Avenue","weight":12.92,"duration":95.9,"distance":119.7}],"weight_name":"routability","weight":12.92,"duration":95.9,"distance":119.7}],"waypoints":[{"hint":"w8hAhX4DrpXfAAAAHwAAAEUCAAAAAAAAKRR6QWerB0A9qSJCAAAAAH0AAAARAAAARQEAAAAAAABIAAAABd7v_xYHBwMB3u__DAcHAwIAjwYKQCFz","distance":1.147662261,"name":"Goldsmith Avenue","location":[-1.057275,50.792214]},{"hint":"Mnvth233uJm9AwAA2wEAAGQBAAAAAAAArCuGQq6hBEIdPsdBAAAAABgCAAAKAQAAxwAAAAAAAABIAAAA-Njv_34IBwP02O__eggHAwEAbwcKQCFz","distance":0.526887278,"name":"Goldsmith Avenue","location":[-1.058568,50.792574]}]}');

      Location lastBusStop = Location(-1.09238477219601, 50.7953755013164);
      when(server.getResponseBody(lastBusStop, endLocation)).thenAnswer((_) async =>
      '{"code":"Ok","routes":[{"geometry":{"coordinates":[[-1.092379,50.795415],[-1.093141,50.795458],[-1.093618,50.795492],[-1.0939,50.795503],[-1.09392,50.795559],[-1.093933,50.795597],[-1.093948,50.795641],[-1.094025,50.795729],[-1.093985,50.795769],[-1.093916,50.79583],[-1.094006,50.795878],[-1.094408,50.796028],[-1.094875,50.796171],[-1.094596,50.796532],[-1.094755,50.796535],[-1.094917,50.79653],[-1.094918,50.796567],[-1.094901,50.797116],[-1.095065,50.797036],[-1.095561,50.797016],[-1.095566,50.797052],[-1.09563,50.797045],[-1.09568,50.797042],[-1.095691,50.797121],[-1.095773,50.797108],[-1.095877,50.797092],[-1.095941,50.797165],[-1.095965,50.79723],[-1.098634,50.796654],[-1.098766,50.796553],[-1.098777,50.796663],[-1.098802,50.796927],[-1.099919,50.797197]],"type":"LineString"},"legs":[{"steps":[{"geometry":{"coordinates":[[-1.092379,50.795415],[-1.093141,50.795458],[-1.093618,50.795492],[-1.0939,50.795503]],"type":"LineString"},"maneuver":{"bearing_after":275,"bearing_before":0,"location":[-1.092379,50.795415],"type":"depart"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"entry":[true],"bearings":[275],"location":[-1.092379,50.795415]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,90,195,270],"location":[-1.093141,50.795458]}],"weight":10.77,"duration":86.1,"distance":107.7},{"geometry":{"coordinates":[[-1.0939,50.795503],[-1.09392,50.795559],[-1.093933,50.795597],[-1.093948,50.795641],[-1.094025,50.795729],[-1.093985,50.795769],[-1.093916,50.79583]],"type":"LineString"},"maneuver":{"bearing_after":345,"bearing_before":272,"location":[-1.0939,50.795503],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[90,255,345],"location":[-1.0939,50.795503]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[90,165,255,345],"location":[-1.09392,50.795559]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[75,165,270,330],"location":[-1.093948,50.795641]},{"out":0,"in":3,"entry":[true,true,true,false,true],"bearings":[30,105,120,180,300],"location":[-1.093985,50.795769]}],"weight":3.640000000,"duration":32.5,"distance":40.5},{"geometry":{"coordinates":[[-1.093916,50.79583],[-1.094006,50.795878],[-1.094408,50.796028],[-1.094875,50.796171]],"type":"LineString"},"maneuver":{"bearing_after":307,"bearing_before":35,"location":[-1.093916,50.79583],"modifier":"left","type":"end of road"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[90,210,315],"location":[-1.093916,50.79583]}],"weight":6.48,"duration":62.2,"distance":77.8},{"geometry":{"coordinates":[[-1.094875,50.796171],[-1.094596,50.796532]],"type":"LineString"},"maneuver":{"bearing_after":25,"bearing_before":295,"location":[-1.094875,50.796171],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[30,120,285],"location":[-1.094875,50.796171]}],"weight":3.73,"duration":35.8,"distance":44.7},{"geometry":{"coordinates":[[-1.094596,50.796532],[-1.094755,50.796535],[-1.094917,50.79653]],"type":"LineString"},"maneuver":{"bearing_after":270,"bearing_before":25,"location":[-1.094596,50.796532],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true,true],"bearings":[120,210,270,345],"location":[-1.094596,50.796532]}],"weight":1.89,"duration":18.2,"distance":22.7},{"geometry":{"coordinates":[[-1.094917,50.79653],[-1.094918,50.796567],[-1.094901,50.797116]],"type":"LineString"},"maneuver":{"bearing_after":358,"bearing_before":267,"location":[-1.094917,50.79653],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[0,90,270],"location":[-1.094917,50.79653]},{"out":0,"in":2,"entry":[true,true,false,true],"bearings":[0,90,180,270],"location":[-1.094918,50.796567]}],"weight":5.43,"duration":52.199999999,"distance":65.2},{"geometry":{"coordinates":[[-1.094901,50.797116],[-1.095065,50.797036],[-1.095561,50.797016]],"type":"LineString"},"maneuver":{"bearing_after":232,"bearing_before":0,"location":[-1.094901,50.797116],"modifier":"sharp left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,225],"location":[-1.094901,50.797116]}],"weight":4.14,"duration":39.7,"distance":49.7},{"geometry":{"coordinates":[[-1.095561,50.797016],[-1.095566,50.797052]],"type":"LineString"},"maneuver":{"bearing_after":354,"bearing_before":265,"location":[-1.095561,50.797016],"modifier":"right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":0,"in":1,"entry":[true,false,true],"bearings":[0,90,180],"location":[-1.095561,50.797016]}],"weight":0.4,"duration":3.2,"distance":4},{"geometry":{"coordinates":[[-1.095566,50.797052],[-1.09563,50.797045]],"type":"LineString"},"maneuver":{"bearing_after":260,"bearing_before":354,"location":[-1.095566,50.797052],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,255],"location":[-1.095566,50.797052]}],"weight":0.46,"duration":3.7,"distance":4.6},{"geometry":{"coordinates":[[-1.09563,50.797045],[-1.09568,50.797042],[-1.095691,50.797121],[-1.095773,50.797108],[-1.095877,50.797092]],"type":"LineString"},"maneuver":{"bearing_after":324,"bearing_before":260,"location":[-1.09563,50.797045],"modifier":"slight right","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,75,180,330],"location":[-1.09563,50.797045]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[0,120,180,255],"location":[-1.095773,50.797108]}],"weight":2.58,"duration":20.7,"distance":25.9},{"geometry":{"coordinates":[[-1.095877,50.797092],[-1.095941,50.797165],[-1.095965,50.79723]],"type":"LineString"},"maneuver":{"bearing_after":330,"bearing_before":255,"location":[-1.095877,50.797092],"modifier":"right","type":"end of road"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":0,"entry":[false,true,true],"bearings":[75,165,330],"location":[-1.095877,50.797092]},{"out":3,"in":1,"entry":[true,false,true,true],"bearings":[60,150,255,345],"location":[-1.095941,50.797165]}],"weight":1.67,"duration":13.3,"distance":16.7},{"geometry":{"coordinates":[[-1.095965,50.79723],[-1.098634,50.796654],[-1.098766,50.796553]],"type":"LineString"},"maneuver":{"bearing_after":250,"bearing_before":345,"location":[-1.095965,50.79723],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[30,165,255],"location":[-1.095965,50.79723]}],"weight":17.79,"duration":172.8,"distance":213.5},{"geometry":{"coordinates":[[-1.098766,50.796553],[-1.098777,50.796663],[-1.098802,50.796927]],"type":"LineString"},"maneuver":{"bearing_after":355,"bearing_before":219,"location":[-1.098766,50.796553],"modifier":"sharp right","type":"turn"},"mode":"walking","driving_side":"right","name":"Burnaby Road","intersections":[{"out":0,"in":1,"entry":[true,false,true,true,true,true],"bearings":[0,45,75,180,225,255],"location":[-1.098766,50.796553]}],"weight":4.17,"duration":33.3,"distance":41.7},{"geometry":{"coordinates":[[-1.098802,50.796927],[-1.099919,50.797197]],"type":"LineString"},"maneuver":{"bearing_after":289,"bearing_before":355,"location":[-1.098802,50.796927],"modifier":"left","type":"turn"},"mode":"walking","driving_side":"right","name":"","intersections":[{"out":2,"in":1,"entry":[true,false,true],"bearings":[0,180,285],"location":[-1.098802,50.796927]}],"weight":8.44,"duration":67.5,"distance":84.3},{"geometry":{"coordinates":[[-1.099919,50.797197],[-1.099919,50.797197]],"type":"LineString"},"maneuver":{"bearing_after":0,"bearing_before":291,"location":[-1.099919,50.797197],"modifier":"right","type":"arrive"},"mode":"walking","driving_side":"right","name":"","intersections":[{"in":0,"entry":[true],"bearings":[111],"location":[-1.099919,50.797197]}],"weight":0,"duration":0,"distance":0}],"summary":"Burnaby Road","weight":71.59,"duration":641.2,"distance":799}],"weight_name":"routability","weight":71.59,"duration":641.2,"distance":799}],"waypoints":[{"hint":"upObgRDmB4sbAgAA3gAAAAAAAAAAAAAAb9hXQkJFsUEAAAAAAAAAAK8BAACyAAAAAAAAAAAAAABIAAAA5VTv_5cTBwPfVO__cBMHAwAA_wUKQCFz","distance":4.359108201,"name":"","location":[-1.092379,50.795415]},{"hint":"WKShilmkoYrbAQAATAMAAAAAAAAAAAAAJVg-QgqkqEIAAAAAAAAAAHwBAACjAgAAAAAAAAAAAABIAAAAcTfv_40aBwP_N-__eBsHAwAA7wYKQCFz","distance":27.995461063,"name":"","location":[-1.099919,50.797197]}]}');

      when(geoJsonLoader.getBusRouteGeoJson()).thenAnswer((_) async =>
      jsonDecode('{   "type": "FeatureCollection",   "features": [     {       "leg":  1,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.092379274573858,             50.79545508221133           ],           [             -1.0931314759812096,             50.79550748031431           ],           [             -1.0939118897334765,             50.79555278259866           ],           [             -1.0944374744360346,             50.795434492985095           ],           [             -1.0949710225243336,             50.79516771146692           ],           [             -1.095261686800825,             50.79493616410002           ],           [             -1.095444845131368,             50.79471719976388           ],           [             -1.0955961498384,             50.79450578494905           ],           [             -1.0957713447624542,             50.79451081864599           ],           [             -1.0959863567139223,             50.79468448086698           ],           [             -1.0961734967470704,             50.79476250281422           ],           [             -1.0964004538076892,             50.7947574691444           ],           [             -1.096886221639295,             50.7945737398538           ],           [             -1.0972286480821367,             50.794450414282466           ]         ],         "type": "LineString"       }     },     {       "leg": 2,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0972286480821367,             50.794450414282466           ],           [             -1.0980448970329064,             50.794208795921776           ],           [             -1.0982917626078859,             50.79410812122475           ],           [             -1.0984112137479372,             50.79402003072019           ],           [             -1.0993946934304972,             50.79283708505656           ],           [             -1.0993190407886004,             50.79274899239766           ],           [             -1.0993270041938388,             50.79265838235011           ],           [             -1.0993349675990771,             50.79260300945671           ],           [             -1.0958781896484027,             50.791368261883406           ],           [             -1.0958252075146504,             50.79135973993547           ],           [             -1.095771963266202,             50.79139713786151           ],           [             -1.09565068470107,             50.79140648733849           ],           [             -1.095570818328838,             50.79137656900568           ],           [             -1.0955382801768394,             50.79132234197948           ],           [             -1.0954791199010856,             50.79129803329204           ],           [             -1.0953430512658429,             50.7912344566646           ],           [             -1.0948135666379528,             50.79117088005293           ],           [             -1.0919813138718837,             50.79079185213834           ],           [             -1.0900007054478635,             50.790532322361145           ],           [             -1.0883196815589997,             50.79024824102345           ],           [             -1.0863945492246216,             50.78990453542434           ],           [             -1.0845726855090447,             50.78954092805131           ]         ],         "type": "LineString"       }     },     {       "leg": 3,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0845726855090447,             50.78954092805131           ],           [             -1.0841642804252842,             50.78945210295558           ],           [             -1.0828938049673695,             50.78925920372566           ],           [             -1.0826692520208212,             50.7893128399821           ],           [             -1.0826669053594742,             50.78919416003086           ],           [             -1.0826481320740413,             50.7890799302935           ],           [             -1.0826234138275481,             50.78877288925315           ],           [             -1.0826532429222198,             50.78847117001894           ],           [             -1.082403484955563,             50.78841560376722           ],           [             -1.0822841685758533,             50.788328387584556           ],           [             -1.082021950908711,             50.78800556395498           ],           [             -1.0816131666141189,             50.78759077329835           ],           [             -1.0814938502344091,             50.78747291147397           ],           [             -1.0813670765813868,             50.78740690872252           ],           [             -1.0807690988393688,             50.78715335929505           ],           [             -1.0805817753561655,             50.78711441988929           ]         ],         "type": "LineString"       }     },     {       "leg": 4,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0805817753561655,             50.78711441988929           ],           [             -1.0798776637926153,             50.78695988049017           ],           [             -1.0790051627509456,             50.78685144637197           ],           [             -1.0781065611346605,             50.78673594005721           ],           [             -1.077174401956455,             50.786693509128725           ],           [             -1.076551719372702,             50.78666050757056           ],           [             -1.0758842934433233,             50.786627505620544           ],           [             -1.0754182138345811,             50.78665343571649           ],           [             -1.0745009693414431,             50.78671236756881           ],           [             -1.074217593288921,             50.786738297487545           ],           [             -1.0724651348895975,             50.78653321371738           ],           [             -1.0711084153020067,             50.78638296324172           ]         ],         "type": "LineString"       }     },     {       "leg": 5,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0711084153020067,             50.78638296324172           ],           [             -1.0704026912680717,             50.78626443971689           ],           [             -1.0691242856065628,             50.78613072519039           ],           [             -1.067831779500466,             50.786038610651445           ],           [             -1.0676202784652844,             50.78605049640856           ],           [             -1.067366477223004,             50.78612181088883           ],           [             -1.0671690762599724,             50.786258496677135           ],           [             -1.0668870748795598,             50.78665666602748           ],           [             -1.066647373706303,             50.786820092764685           ],           [             -1.066236132661345,             50.78695453743242           ],           [             -1.0659024310468794,             50.786990193971235           ],           [             -1.0653760284697285,             50.786963451550605           ],           [             -1.06432131931615,             50.786894274701524           ],           [             -1.062977112735723,             50.786817018619786           ],           [             -1.062560100036933,             50.786789719744036           ],           [             -1.0611604852804817,             50.78668829699345           ],           [             -1.0604463767218135,             50.78664240423092           ],           [             -1.0597201330163557,             50.78659550600793           ]         ],         "type": "LineString"       }     },     {       "leg": 6,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0597201330163557,             50.78659550600793           ],           [             -1.058790174051154,             50.78653026261034           ],           [             -1.0583393886826968,             50.78651139576178           ],           [             -1.0581055317613846,             50.786506019537086           ],           [             -1.0573231739583662,             50.78665117830576           ],           [             -1.0570212858920058,             50.786777519830224           ],           [             -1.056749161438887,             50.78689042047796           ],           [             -1.0563494789312813,             50.78729618148665           ],           [             -1.0558903414689667,             50.787524897126616           ],           [             -1.0557457753536426,             50.78759747498532           ],           [             -1.055647980627782,             50.78785015257827           ],           [             -1.0553526517073237,             50.789099211064524           ],           [             -1.0550596407375394,             50.790620213781835           ],           [             -1.0550625184658315,             50.79067792354215           ]         ],         "type": "LineString"       }     },     {       "leg": 7,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0550625184658315,             50.79067792354215           ],           [             -1.0550550981020308,             50.79086934111015           ],           [             -1.055110289707926,             50.79107481992412           ],           [             -1.0553228869371765,             50.79134898153552           ],           [             -1.055629026947912,             50.791582823992144           ],           [             -1.056105224444451,             50.79181127680542           ],           [             -1.0566664810318969,             50.79208005844549           ],           [             -1.0568228763099228,             50.79211348189182           ],           [             -1.056961525399231,             50.79215297031578           ],           [             -1.0571016981058108,             50.79218090113204           ],           [             -1.0574003269135233,             50.79222905767293           ],           [             -1.0577799897618831,             50.79230468046808           ],           [             -1.0580543000123726,             50.79239496337178           ],           [             -1.058555710690456,             50.79255324457131           ]         ],         "type": "LineString"       }     },     {       "leg": 8,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.058555710690456,             50.79255324457131           ],           [             -1.0591632236028943,             50.79276873036031           ],           [             -1.0600739489642876,             50.79308644787176           ],           [             -1.062093473930446,             50.79380509023537           ],           [             -1.0628103611903725,             50.794009338696014           ],           [             -1.063580564147884,             50.79418306978582           ],           [             -1.0646796983795639,             50.79439539589981           ],           [             -1.0655168160320443,             50.79450091516378           ],           [             -1.0666644322335515,             50.79461004787848           ],           [             -1.0671126063364795,             50.7947437333317           ],           [             -1.0673089127100752,             50.79476121411105           ],           [             -1.0676892206602702,             50.79475313368303           ],           [             -1.067992827847263,             50.794706671194206           ],           [             -1.0684338571738294,             50.79476323426533           ],           [             -1.069740965530741,             50.79496524427853           ]         ],         "type": "LineString"       }     },     {       "leg": 9,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.069740965530741,             50.79496524427853           ],           [             -1.071199753137705,             50.79522114172801           ],           [             -1.071637596656501,             50.79530194476004           ],           [             -1.0724908926460444,             50.795495872371475           ],           [             -1.07298265894471,             50.79560041649333           ],           [             -1.0742737874818147,             50.79588524520602           ],           [             -1.0747499105371503,             50.7959983299406           ],           [             -1.0755552685491239,             50.796044791145334           ],           [             -1.0760140300555179,             50.79599937236395           ]         ],         "type": "LineString"       }     },     {       "leg": 10,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.0760140300555179,             50.79599937236395           ],           [             -1.07639258516852,             50.7959599491858           ],           [             -1.0765747494807556,             50.795834705605785           ],           [             -1.0766290791702318,             50.79571754221894           ],           [             -1.076718563394337,             50.795624619112886           ],           [             -1.0769710367398204,             50.79557209727574           ],           [             -1.077172376242828,             50.79553977611579           ],           [             -1.0777721093051866,             50.79546893652363           ],           [             -1.0783984989984958,             50.79532753113969           ],           [             -1.0788427242520982,             50.79519622560116           ],           [             -1.0789513836660092,             50.7951376430112           ],           [             -1.0790760224057578,             50.795038658468           ],           [             -1.0791015893275073,             50.79501643741949           ],           [             -1.0791525592211997,             50.794858975113556           ],           [             -1.0795903927438246,             50.794727668258616           ],           [             -1.079970700610886,             50.79486705569113           ],           [             -1.0803893589427105,             50.794980181281176           ],           [             -1.0806673983730377,             50.794998361998154           ],           [             -1.0809070882576464,             50.79499028161112           ],           [             -1.081402446779066,             50.79497614072022           ],           [             -1.0824347112147734,             50.79491755785412           ],           [             -1.0830195551123438,             50.79487311590799           ],           [             -1.083626769486301,             50.7948468545745           ]         ],         "type": "LineString"       }     },     {       "leg": 11,       "type": "Feature",       "properties": {},       "geometry": {         "coordinates": [           [             -1.083626769486301,             50.7948468545745           ],           [             -1.0844193443698487,             50.794863015772506           ],           [             -1.0854963507631226,             50.79492159880354           ],           [             -1.0866467621625304,             50.795010504140635           ],           [             -1.087672634405294,             50.795089294455465           ],           [             -1.0880273754347627,             50.79512161592689           ],           [             -1.0881824794930424,             50.79514787722178           ],           [             -1.0885020660058444,             50.795246861533656           ],           [             -1.088665055127251,             50.79520039953567           ],           [             -1.088760931081282,             50.79518625891856           ],           [             -1.0889696146099652,             50.795255544175035           ],           [             -1.089158170652098,             50.79524342366054           ],           [             -1.0893403347999708,             50.79521918278098           ],           [             -1.0897717765916468,             50.79523736356094           ],           [             -1.089918786388182,             50.79525756441919           ],           [             -1.0903917745092144,             50.79530200637549           ],           [             -1.0906282685288886,             50.79532220720614           ],           [             -1.0912892005675303,             50.79536624981347           ],           [             -1.0919603322184912,             50.79542281210837           ],           [             -1.092379274573858,             50.79545508221133           ]         ],         "type": "LineString"       }     }   ] }'));

      when(dateTimeWrapper.now()).thenAnswer((_) => DateTime(2023, 03, 15, 13, 20, 30));

      WalkingRoute testRoute = WalkingRoute({
        GeoJsonGeometry('{"coordinates":[[-1.092379,50.795415],[-1.093141,50.795458],[-1.093618,50.795492],[-1.0939,50.795503],[-1.09392,50.795559],[-1.093933,50.795597],[-1.093948,50.795641],[-1.094025,50.795729],[-1.093985,50.795769],[-1.093916,50.79583],[-1.094006,50.795878],[-1.094408,50.796028],[-1.094875,50.796171],[-1.094596,50.796532],[-1.094755,50.796535],[-1.094917,50.79653],[-1.094918,50.796567],[-1.094901,50.797116],[-1.095065,50.797036],[-1.095561,50.797016],[-1.095566,50.797052],[-1.09563,50.797045],[-1.09568,50.797042],[-1.095691,50.797121],[-1.095773,50.797108],[-1.095877,50.797092],[-1.095941,50.797165],[-1.095965,50.79723],[-1.098634,50.796654],[-1.098766,50.796553],[-1.098777,50.796663],[-1.098802,50.796927],[-1.099919,50.797197]],"type":"LineString"}'),
        GeoJsonGeometry('{"coordinates":[[-1.057275,50.792214],[-1.057246,50.792209],[-1.057252,50.792282],[-1.057355,50.792363],[-1.057475,50.792403],[-1.057586,50.792364],[-1.057751,50.792382],[-1.058033,50.792459],[-1.058116,50.792485],[-1.058153,50.792434],[-1.058568,50.792574]],"type":"LineString"}'),
        GeoJsonGeometry.setColour('{"type":"FeatureCollection","features":[{"leg":8,"type":"Feature","properties":{},"geometry":{"coordinates":[[-1.058568,50.792574],[-1.0591632236028943,50.79276873036031],[-1.0600739489642876,50.79308644787176],[-1.062093473930446,50.79380509023537],[-1.0628103611903725,50.794009338696014],[-1.063580564147884,50.79418306978582],[-1.0646796983795639,50.79439539589981],[-1.0655168160320443,50.79450091516378],[-1.0666644322335515,50.79461004787848],[-1.0671126063364795,50.7947437333317],[-1.0673089127100752,50.79476121411105],[-1.0676892206602702,50.79475313368303],[-1.067992827847263,50.794706671194206],[-1.0684338571738294,50.79476323426533],[-1.069740965530741,50.79496524427853]],"type":"LineString"}},{"leg":9,"type":"Feature","properties":{},"geometry":{"coordinates":[[-1.069740965530741,50.79496524427853],[-1.071199753137705,50.79522114172801],[-1.071637596656501,50.79530194476004],[-1.0724908926460444,50.795495872371475],[-1.07298265894471,50.79560041649333],[-1.0742737874818147,50.79588524520602],[-1.0747499105371503,50.7959983299406],[-1.0755552685491239,50.796044791145334],[-1.0760140300555179,50.79599937236395]],"type":"LineString"}},{"leg":10,"type":"Feature","properties":{},"geometry":{"coordinates":[[-1.0760140300555179,50.79599937236395],[-1.07639258516852,50.7959599491858],[-1.0765747494807556,50.795834705605785],[-1.0766290791702318,50.79571754221894],[-1.076718563394337,50.795624619112886],[-1.0769710367398204,50.79557209727574],[-1.077172376242828,50.79553977611579],[-1.0777721093051866,50.79546893652363],[-1.0783984989984958,50.79532753113969],[-1.0788427242520982,50.79519622560116],[-1.0789513836660092,50.7951376430112],[-1.0790760224057578,50.795038658468],[-1.0791015893275073,50.79501643741949],[-1.0791525592211997,50.794858975113556],[-1.0795903927438246,50.794727668258616],[-1.079970700610886,50.79486705569113],[-1.0803893589427105,50.794980181281176],[-1.0806673983730377,50.794998361998154],[-1.0809070882576464,50.79499028161112],[-1.081402446779066,50.79497614072022],[-1.0824347112147734,50.79491755785412],[-1.0830195551123438,50.79487311590799],[-1.083626769486301,50.7948468545745]],"type":"LineString"}},{"leg":11,"type":"Feature","properties":{},"geometry":{"coordinates":[[-1.083626769486301,50.7948468545745],[-1.0844193443698487,50.794863015772506],[-1.0854963507631226,50.79492159880354],[-1.0866467621625304,50.795010504140635],[-1.087672634405294,50.795089294455465],[-1.0880273754347627,50.79512161592689],[-1.0881824794930424,50.79514787722178],[-1.0885020660058444,50.795246861533656],[-1.088665055127251,50.79520039953567],[-1.088760931081282,50.79518625891856],[-1.0889696146099652,50.795255544175035],[-1.089158170652098,50.79524342366054],[-1.0893403347999708,50.79521918278098],[-1.0897717765916468,50.79523736356094],[-1.089918786388182,50.79525756441919],[-1.0903917745092144,50.79530200637549],[-1.0906282685288886,50.79532220720614],[-1.0912892005675303,50.79536624981347],[-1.0919603322184912,50.79542281210837],[-1.092379,50.795415]],"type":"LineString"}}]}', "purple")},
          641.2 +
              ((DateTime(2023, 03, 15, 13, 32, 00).millisecondsSinceEpoch - DateTime(2023, 03, 15, 13, 20, 30).millisecondsSinceEpoch) / 1000),
          119.7 + 799, 2.1, null);

      AdvancedRouteCreator routeCreator = AdvancedRouteCreator.setServer(busStops, server, geoJsonLoader, dateTimeWrapper);
      WalkingRoute route = await routeCreator.createRoute(startLocation, endLocation);

      expect(route.getGeometries(), testRoute.getGeometries());
      expect(route.getDistanceTillNextTurn(), testRoute.getDistanceTillNextTurn());
      expect(null, testRoute.getNextTurn());
      expect(route.getTotalDistance(), testRoute.getTotalDistance());
      expect(route.getTotalSeconds(), testRoute.getTotalSeconds());
    });
  });
}